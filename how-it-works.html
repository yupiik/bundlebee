<!DOCTYPE html>
<html lang="en">
<head>
    <title>How it works</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A light Java Kubernetes package manager.">
    <meta name="author" content="Yupiik Minisite Generator">
    <link rel="shortcut icon" href="//www.yupiik.com/img/favicon.png">

    <link href="//fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,700,700i|Montserrat:300,400,500,700" rel="stylesheet">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" crossorigin="anonymous" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/asciidoctor.js/1.5.5-5/css/asciidoctor.min.css" integrity="sha512-kI7tn5cuEg16kMeXnYmg8rEJPxbxzEM7Gsr191iQdLDevFBLXPCSU9aZWSVuP61tMZWU3nBAR1cJ7SmXnOGLZw==" crossorigin="anonymous" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.3/css/bootstrap.min.css" integrity="sha512-oc9+XSs1H243/FRN9Rw62Fn8EtxjEYWHXRvjS43YtueEewbS6ObfXcJNyohjHqVKFPoXXUxwc+q1K7Dee6vv9g==" crossorigin="anonymous" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.4.1/styles/vs2015.min.css" integrity="sha512-w8aclkBlN3Ha08SMwFKXFJqhSUx2qlvTBFLLelF8sm4xQnlg64qmGB/A6pBIKy0W8Bo51yDMDtQiPLNRq1WMcQ==" crossorigin="anonymous" />
    <link id="theme-style" rel="stylesheet" href="//yupiik.github.io/bundlebee/css/theme.css?v=1.0.1-SNAPSHOT">
    
</head>

<body>
    <header class="header fixed-top">
        <div class="branding docs-branding">
            <div class="container-fluid position-relative py-2">
                <div class="docs-logo-wrapper">
	                <div class="site-logo"><a class="navbar-brand" href="//yupiik.github.io/bundlebee/index.html">
	                <img class="logo-icon mr-2" src="//www.yupiik.com/img/favicon.png" alt="logo">
	                <span class="logo-text">Yupiik BundleBee <span class="text-alt">Docs</span></span></a></div>
                </div>
	            <div class="docs-top-utilities d-flex justify-content-end align-items-center">
					
					<li class="list-inline-item"><a id="search-button" href="#" data-toggle="modal" data-target="#searchModal"><i data-toggle="tooltip" data-placement="top" title="Search" class="fas fa-search"></i></a></li>

					<ul class="social-list list-inline mx-md-3 mx-lg-5 mb-0 d-none d-lg-flex">
						<li class="list-inline-item"><a href="https://www.linkedin.com/company/yupiik/"><i class="fab fa-linkedin fa-fw"></i></a></li>
		            </ul>
	            </div>
            </div>
        </div>
    </header>
	<div class="page">
        <div class="page-navigation-left">
            <h3>Menu</h3>
            <ul>
                <li><a href="//yupiik.github.io/bundlebee/getting-started.html"><i class="fas fa-play"></i> Getting Started</a></li>
                <li><a href="//yupiik.github.io/bundlebee/how-it-works.html"><i class="fas fa-car-battery"></i> How it works</a></li>
                <li><a href="//yupiik.github.io/bundlebee/commands.html"><i class="fas fa-terminal"></i> Commands</a></li>
                <li><a href="//yupiik.github.io/bundlebee/alveoli.html"><i class="fas fa-puzzle-piece"></i> Alveoli</a></li>
                <li><a href="//yupiik.github.io/bundlebee/maven-plugin.html"><i class="fas fa-building"></i> Maven Plugin</a></li>
            </ul>
        </div>

        <div class="container page-content">
            <div class="page-header">
                <h1>How it works</h1>
            </div>
            <div class="page-content-body">
<div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
BundleBee is a light Java package manager for Kubernetes applications.
This page explains how to get started with it.
</blockquote>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overall_architecture">Overall architecture</h2>
<div class="sectionbody">
<div class="paragraph">
<p>One of the BundleBee goals is to inherit from the well known and supported Apache Maven infrastructure.
In other words, the goal is to be able to reuse Maven registries (central, custom nexus, artifactory, &#8230;&#8203;) to store application descriptors.
It also leverage the well know java packaging (jar or zip) to ensure a strong storage reliability in these systems.</p>
</div>
<div class="paragraph">
<p>One direct benefit is that it becomes very easy to have an immutable system once deployed and therefore a better tracability of what is deployed.</p>
</div>
<div class="paragraph">
<p>Overall, BundleBee will manipulate what we call <code>alveolus</code> which are basically just a set of descriptors.
An <code>alveolus</code> is a zip or a jar which is structured this way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">.root
 `- bundlebee <b class="conum">(1)</b>
      |- manifest.json <b class="conum">(2)</b>
      `- kubernetes <b class="conum">(3)</b>
           |- my-descriptor-1.yaml
           `- my-descriptor-2.yaml</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>A <code>bundlebee</code> folder contains all the descriptors</p>
</li>
<li>
<p>A <code>manifest.json</code> contains the list of application or library this alveolus provides</p>
</li>
<li>
<p>A <code>kubenetes</code> folder contains the list of descriptors used by alveoli</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_manifest">Manifest</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Manifest is the central point of the system.
It provides the unique identifier of your recipe (application/library) and what to do to set it up.</p>
</div>
<div class="paragraph">
<p>Here is its configuration specification:</p>
</div>
<div class="sect2">
<h3 id="_manifest_descriptor">Manifest Descriptor</h3>
<div class="paragraph">
<p>BundleBee manifest descriptor.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Manifest Descriptor</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">JSON Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#io_yupiik_bundlebee_core_descriptor_Manifest_Alveolus">Manifest.alveoli</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>alveoli</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">array of object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of described applications/libraries.</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="io_yupiik_bundlebee_core_descriptor_Manifest_Alveolus">Manifest.alveoli</h4>
<div class="paragraph">
<p>List of described applications/libraries.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Manifest.alveoli</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">JSON Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the alveolus (recipe). It must be unique accross the whole classpath. Using maven style identifier, it is recommended to name it <code>&lt;groupId&gt;:&lt;artifactId&gt;:&lt;version&gt;</code> using maven filtering but it is not enforced.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If name does not follow <code>&lt;groupId&gt;:&lt;artifactId&gt;:&lt;version&gt;</code> naming (i.e. version can&#8217;t be extracted from the name) then you can specify the version there. Note that if set, this is used in priority (explicit versus deduced).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#io_yupiik_bundlebee_core_descriptor_Manifest_AlveolusDependency">Alveolus.dependencies</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dependencies</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">array of object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dependencies of this alveolus. It is a way to import transitively a set of descriptors.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#io_yupiik_bundlebee_core_descriptor_Manifest_Descriptor">Alveolus.descriptors</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>descriptors</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">array of object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of descriptors to install for this alveolus. This is required even if an empty array.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#io_yupiik_bundlebee_core_descriptor_Manifest_Patch">Alveolus.patches</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>patches</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">array of object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Patches on descriptors. It enables to inject configuration in descriptors by patching (using JSON-Patch or plain interpolation with <code>${key}</code> values) their JSON representation. The key is the descriptor name and each time the descriptor is found it will be applied.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="io_yupiik_bundlebee_core_descriptor_Manifest_AlveolusDependency">Alveolus.dependencies</h4>
<div class="paragraph">
<p>Dependencies of this alveolus. It is a way to import transitively a set of descriptors.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Alveolus.dependencies</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">JSON Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">location</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>location</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Where to find the alveolus. Note it will ensure the jar is present on the local maven repository.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alveolus name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#io_yupiik_bundlebee_core_descriptor_Manifest_Conditions">Descriptor.includeIf</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>includeIf</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conditions to include this dependency. Enables for example to have an environment variable enabling part of the stack (ex: <code>MONITORING=true</code>)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="io_yupiik_bundlebee_core_descriptor_Manifest_Descriptor">Alveolus.descriptors</h4>
<div class="paragraph">
<p>List of descriptors to install for this alveolus. This is required even if an empty array.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Alveolus.descriptors</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">JSON Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">interpolate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>interpolate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to <code>true</code>, it will interpolate the descriptor just before applying it - i.e. after it had been patched if needed. You can use <code>--&lt;config-key&gt; &lt;value&gt;</code> to inject bindings set as <code>{{config-key:-default value}}</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">location</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>location</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional, if coming form another manifest, the dependency to download to get the alveolus.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the descriptor to install. For kubernetes descriptors you can omit the <code>.yaml</code> extension.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type of this descriptor. For now only <code>kubernetes</code> is supported. It also defines in which folder under <code>bundlebee</code> the descriptor(s) are looked for from its name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#io_yupiik_bundlebee_core_descriptor_Manifest_Conditions">Descriptor.includeIf</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>includeIf</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conditions to include this descriptor.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="io_yupiik_bundlebee_core_descriptor_Manifest_Conditions">Descriptor.includeIf</h4>
<div class="paragraph">
<p>Conditions to include this descriptor.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Descriptor.includeIf</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">JSON Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>operator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operator to combine the conditions. Potential values: <code>ANY</code> (At least one condition must match.),<code>ALL</code> (All conditions must match.).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#io_yupiik_bundlebee_core_descriptor_Manifest_Condition">Conditions.conditions</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>conditions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">array of object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of condition to match according <code>operator</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="io_yupiik_bundlebee_core_descriptor_Manifest_Condition">Conditions.conditions</h4>
<div class="paragraph">
<p>List of condition to match according <code>operator</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Conditions.conditions</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">JSON Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Expected key. If empty/null condition is ignored. If read value is null it defaults to an empty string.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">negate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>negate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should the condition be reversed (ie "not in this case").</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type of condition. Potential values: <code>ENV</code> (Key is read is process environment variables.),<code>SYSTEM_PROPERTY</code> (Key is read is process system properties.).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Expected value. If empty/null, <code>true</code> is assumed. Note that empty is allowed.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="io_yupiik_bundlebee_core_descriptor_Manifest_Patch">Alveolus.patches</h4>
<div class="paragraph">
<p>Patches on descriptors. It enables to inject configuration in descriptors by patching (using JSON-Patch or plain interpolation with <code>${key}</code> values) their JSON representation. The key is the descriptor name and each time the descriptor is found it will be applied.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Alveolus.patches</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">JSON Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">descriptorName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>descriptorName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The descriptor to patch. It can be any descriptor, including transitive ones. It can be <code>*</code> to patch all descriptors (<code>/metadata/label/app</code> for example) or <code>regex:&lt;java pattern&gt;</code> to match descriptor names with a regex.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">interpolate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>interpolate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to <code>true</code>, it will interpolate the patch from the execution configuration which means you can use <code>--&lt;config-key&gt; &lt;value&gt;</code> to inject bindings too.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">patch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>patch</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">array of object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSON-Patch to apply on the JSON representation of the descriptor. It enables to inject configuration in descriptors for example, or changing some name/application.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_json_schema">JSON-Schema</h3>
<div class="paragraph">
<p>If you use JSON-Schema facilities in your preferred editor, here is the raw JSON-Schema for the manifest descriptor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="json" class="language-json hljs">{
  "$id":"io_yupiik_bundlebee_core_descriptor_Manifest",
  "type":"object",
  "title":"Manifest Descriptor",
  "description":"BundleBee manifest descriptor.",
  "definitions":{
    "io_yupiik_bundlebee_core_descriptor_Manifest_Conditions":{
      "$id":"io_yupiik_bundlebee_core_descriptor_Manifest_Conditions",
      "type":"object",
      "title":"Descriptor.includeIf",
      "description":"Conditions to include this descriptor.",
      "properties":{
        "conditions":{
          "type":"array",
          "title":"Conditions.conditions",
          "description":"List of condition to match according `operator`.",
          "items":{
            "$id":"io_yupiik_bundlebee_core_descriptor_Manifest_Condition",
            "type":"object",
            "properties":{
              "key":{
                "type":"string",
                "title":"Condition.key",
                "description":"Expected key. If empty/null condition is ignored. If read value is null it defaults to an empty string."
              },
              "negate":{
                "type":"boolean",
                "title":"Condition.negate",
                "description":"Should the condition be reversed (ie \"not in this case\")."
              },
              "type":{
                "$id":"io_yupiik_bundlebee_core_descriptor_Manifest_ConditionType",
                "type":"string",
                "title":"Condition.type",
                "description":"Type of condition.",
                "enum":[
                  "ENV",
                  "SYSTEM_PROPERTY"
                ],
                "nullable":true
              },
              "value":{
                "type":"string",
                "title":"Condition.value",
                "description":"Expected value. If empty/null, `true` is assumed. Note that empty is allowed."
              }
            }
          }
        },
        "operator":{
          "$id":"io_yupiik_bundlebee_core_descriptor_Manifest_ConditionOperator",
          "type":"string",
          "title":"Conditions.operator",
          "description":"Operator to combine the conditions.",
          "enum":[
            "ANY",
            "ALL"
          ],
          "nullable":true
        }
      }
    }
  },
  "properties":{
    "alveoli":{
      "type":"array",
      "title":"Manifest.alveoli",
      "description":"List of described applications/libraries.",
      "items":{
        "$id":"io_yupiik_bundlebee_core_descriptor_Manifest_Alveolus",
        "type":"object",
        "properties":{
          "dependencies":{
            "type":"array",
            "title":"Alveolus.dependencies",
            "description":"Dependencies of this alveolus. It is a way to import transitively a set of descriptors.",
            "items":{
              "$id":"io_yupiik_bundlebee_core_descriptor_Manifest_AlveolusDependency",
              "type":"object",
              "properties":{
                "includeIf":{
                  "$ref":"#/definitions/io_yupiik_bundlebee_core_descriptor_Manifest_Conditions",
                  "type":"object",
                  "title":"AlveolusDependency.includeIf",
                  "description":"Conditions to include this dependency. Enables for example to have an environment variable enabling part of the stack (ex: `MONITORING=true`)"
                },
                "location":{
                  "type":"string",
                  "title":"AlveolusDependency.location",
                  "description":"Where to find the alveolus. Note it will ensure the jar is present on the local maven repository."
                },
                "name":{
                  "type":"string",
                  "title":"AlveolusDependency.name",
                  "description":"Alveolus name."
                }
              }
            }
          },
          "descriptors":{
            "type":"array",
            "title":"Alveolus.descriptors",
            "description":"List of descriptors to install for this alveolus. This is required even if an empty array.",
            "items":{
              "$id":"io_yupiik_bundlebee_core_descriptor_Manifest_Descriptor",
              "type":"object",
              "properties":{
                "includeIf":{
                  "$id":"io_yupiik_bundlebee_core_descriptor_Manifest_Conditions",
                  "type":"object",
                  "title":"Descriptor.includeIf",
                  "description":"Conditions to include this descriptor.",
                  "properties":{
                    "conditions":{
                      "type":"array",
                      "title":"Conditions.conditions",
                      "description":"List of condition to match according `operator`.",
                      "items":{
                        "$id":"io_yupiik_bundlebee_core_descriptor_Manifest_Condition",
                        "type":"object",
                        "properties":{
                          "key":{
                            "type":"string",
                            "title":"Condition.key",
                            "description":"Expected key. If empty/null condition is ignored. If read value is null it defaults to an empty string."
                          },
                          "negate":{
                            "type":"boolean",
                            "title":"Condition.negate",
                            "description":"Should the condition be reversed (ie \"not in this case\")."
                          },
                          "type":{
                            "$id":"io_yupiik_bundlebee_core_descriptor_Manifest_ConditionType",
                            "type":"string",
                            "title":"Condition.type",
                            "description":"Type of condition.",
                            "enum":[
                              "ENV",
                              "SYSTEM_PROPERTY"
                            ],
                            "nullable":true
                          },
                          "value":{
                            "type":"string",
                            "title":"Condition.value",
                            "description":"Expected value. If empty/null, `true` is assumed. Note that empty is allowed."
                          }
                        }
                      }
                    },
                    "operator":{
                      "$id":"io_yupiik_bundlebee_core_descriptor_Manifest_ConditionOperator",
                      "type":"string",
                      "title":"Conditions.operator",
                      "description":"Operator to combine the conditions.",
                      "enum":[
                        "ANY",
                        "ALL"
                      ],
                      "nullable":true
                    }
                  }
                },
                "interpolate":{
                  "type":"boolean",
                  "title":"Descriptor.interpolate",
                  "description":"If set to `true`, it will interpolate the descriptor just before applying it - i.e. after it had been patched if needed. You can use `--&lt;config-key&gt; &lt;value&gt;` to inject bindings set as `{{config-key:-default value}}`."
                },
                "location":{
                  "type":"string",
                  "title":"Descriptor.location",
                  "description":"Optional, if coming form another manifest, the dependency to download to get the alveolus."
                },
                "name":{
                  "type":"string",
                  "title":"Descriptor.name",
                  "description":"Name of the descriptor to install. For kubernetes descriptors you can omit the `.yaml` extension."
                },
                "type":{
                  "type":"string",
                  "title":"Descriptor.type",
                  "description":"Type of this descriptor. For now only `kubernetes` is supported. It also defines in which folder under `bundlebee` the descriptor(s) are looked for from its name."
                }
              }
            }
          },
          "name":{
            "type":"string",
            "title":"Alveolus.name",
            "description":"Name of the alveolus (recipe). It must be unique accross the whole classpath. Using maven style identifier, it is recommended to name it `&lt;groupId&gt;:&lt;artifactId&gt;:&lt;version&gt;` using maven filtering but it is not enforced."
          },
          "patches":{
            "type":"array",
            "title":"Alveolus.patches",
            "description":"Patches on descriptors. It enables to inject configuration in descriptors by patching (using JSON-Patch or plain interpolation with `${key}` values) their JSON representation. The key is the descriptor name and each time the descriptor is found it will be applied.",
            "items":{
              "$id":"io_yupiik_bundlebee_core_descriptor_Manifest_Patch",
              "type":"object",
              "properties":{
                "descriptorName":{
                  "type":"string",
                  "title":"Patch.descriptorName",
                  "description":"The descriptor to patch. It can be any descriptor, including transitive ones. It can be `*` to patch all descriptors (`/metadata/label/app` for example) or `regex:&lt;java pattern&gt;` to match descriptor names with a regex."
                },
                "interpolate":{
                  "type":"boolean",
                  "title":"Patch.interpolate",
                  "description":"If set to `true`, it will interpolate the patch from the execution configuration which means you can use `--&lt;config-key&gt; &lt;value&gt;` to inject bindings too."
                },
                "patch":{
                  "type":"array",
                  "title":"Patch.patch",
                  "description":"JSON-Patch to apply on the JSON representation of the descriptor. It enables to inject configuration in descriptors for example, or changing some name/application.",
                  "items":{
                    "type":"object",
                    "properties":{

                    }
                  }
                }
              }
            }
          },
          "version":{
            "type":"string",
            "title":"Alveolus.version",
            "description":"If name does not follow `&lt;groupId&gt;:&lt;artifactId&gt;:&lt;version&gt;` naming (i.e. version can't be extracted from the name) then you can specify the version there. Note that if set, this is used in priority (explicit versus deduced)."
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
you can also use last version from <a href="https://raw.githubusercontent.com/yupiik/bundlebee/gh-pages/generated/jsonschema/manifest.descriptor.json">this link</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_deployment_and_dependency_management">Deployment and Dependency Management</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A manifest can reference descriptors in other alveoli, it just requires to reference them to let bundlebee find them.</p>
</div>
<div class="paragraph">
<p>There are mainly two ways to deploy an alveolus:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Classpath mode: you put all your zip/jar in the classpath. This mode requires there is no conflict between descriptor names (which is the recommended practise) and it will never look for external descriptors.
It is typically a recommended mode to avoid network I/O except with the Kubernetes cluster.</p>
</li>
<li>
<p>Fetch mode: in this mode, a missing descriptor in the classpath will look for <code>descriptor.location</code> and lookup the jar/zip referenced by this location (generally a maven coordinate in the form <code>groupId:artifactId:version</code>).
It will first use your local Maven repository but can download the jar/zip if missing locally.
Then the jar/zip is read and descriptors are looked up from there.
This mode is nicer when depending on a lot of external alveoli but requires I/O to grab the dependencies.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customize_descriptors">Customize descriptors</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Indeed, you can bundle all your stack and hardcode your configuration or create one alveolus per environment.
This is one option which works well and enable to version its configuration.</p>
</div>
<div class="paragraph">
<p>However, for testing purposes, it is also neat to be able to patch descriptors on the fly.
For that you can use <code>descriptor.patches</code> in the manifest which will transitively enable to patch the descriptors - even the ones you don&#8217;t own - using JSON-Patch and interpolations.</p>
</div>
<div class="paragraph">
<p>Here are some examples.</p>
</div>
<div class="listingblock">
<div class="title">Patch using CLI option</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="json" class="language-json hljs">{
  "alveoli": [
    {
      "name": "com.company.alveoli:my-app:${project.version}",
      "descriptors": [
        {
          "name": "com.company.alveoli_my-app.configmap"
        },
        // ...
      ],
      "patches": [ <b class="conum">(1)</b>
        "descriptorName": "com.company.other_alveolus.configmap", <b class="conum">(2)</b>
        "interpolate": true, <b class="conum">(3)</b>
        "patch": [ <b class="conum">(4)</b>
          {
            "op": "replace",
            "path": "data",
            "value": {
              "my.config.value": "{{my.arg:-defaultValue}}" <b class="conum">(5)</b>
            }
          }
        ]
      ]
    }
  ]
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>We add to the alveolus a list of patches to apply on some descriptors</p>
</li>
<li>
<p>We reference the descriptor to patch</p>
</li>
<li>
<p>We enable interpolation from Microprofile Config (which include CLI args)</p>
</li>
<li>
<p>We define the JSON-Patch to use (optional, interpolation will also interpolate the descriptor if designed to be interpolated)</p>
</li>
<li>
<p>We use an interpolation in the configuration in the JSON-Patch <code>replace</code> operation which replaces the data of the referenced <code>ConfigMap</code></p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
this mecanism is very useful for <code>ConfigMap</code> descriptors but also <code>PersistenceVolume</code> since you can now patch `/spec/hostPath `easily too.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_deploy_a_dependency_or_descriptor_conditionally">Deploy a dependency (or descriptor) conditionally</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In some case it can be neat to be able to not deploy part of the stack.
It is typically the case when you wrote a monitoring-full alveolus (ie with some optional services functionally).
In such a case you can condition dependencies and descriptor deployment:</p>
</div>
<div class="listingblock">
<div class="title">Deploy monitoring alveolus only if MONITORING option is set</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="json" class="language-json hljs">{
  "alveoli": [
    {
      "name": "com.company.alveoli:my-app:${project.version}",
      "dependencies": [
        {
          "name": "io.yupiik.alveoli:monitoring-alveolus:${bundlebee.version}",
          "location": "io.yupiik.alveoli:monitoring-alveolus:${bundlebee.version}",
          "includeIf": {
            "conditions": [{
              "key": "MONITORING",
              "value": "true"
            }]
          }
        }
      ]
    }
  ]
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
used on descriptors and using a complete set of conditions for descriptors you can handle environments this way (<code>ENV=preprod</code> for descriptor <code>preprod.configmap</code> for example).
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_filter_manifest_at_command_time">Filter manifest at command time</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In some case it can be needed to evaluate some values of the manifest when executing the command.
Even if not recommended it can be done using <code>{{xxx}}</code> placeholders - read from environment variables and system properties.</p>
</div>
<div class="listingblock">
<div class="title">Filter manifest.json at command time</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="json" class="language-json hljs">{
  "alveoli": [
    {
      "name": "com.company.alveoli:my-app:{{project.version}}",
      "dependencies": [
        {
          "name": "io.yupiik.alveoli:monitoring-alveolus:{{bundlebee.version}}",
          "location": "io.yupiik.alveoli:monitoring-alveolus:{{bundlebee.version}}"
        }
      ]
    }
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this manifest you can value <code>project.version</code> and <code>bundlebee.version</code> using the command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">bundlebee \
    [your command and options] \
    --project.version 1.2.1 \
    --bundlebee.version 1.0.1</code></pre>
</div>
</div>
</div>
</div>
            </div>
        </div>

    <div class="page-navigation-right">
        <h3>Navigation</h3>
        <nav class="generated-nav-menu"></nav>
    </div>
    </div>
    <hr />
    <footer class="footer pb-5">
	    <div class="footer-bottom text-center">
		    <ul class="social-list list-unstyled">
			    <li class="list-inline-item"><a href="https://www.linkedin.com/company/yupiik/"><i class="fab fa-linkedin fa-fw"></i></a></li>
	        </ul>
            <small class="copyright">Yupiik &copy;</small>
	    </div>
    </footer>

    <div class="modal fade" id="searchModal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="searchModalLabel">Search</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form onsubmit="return false;" class="form-inline">
          <div class="form-group">
            <label for="searchInput"><b>Search: </b></label>
            <input class="form-control" id="searchInput" placeholder="Enter search text and hit enter...">
          </div>
        </form>
        <div class="search-hits"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" ></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.3/js/bootstrap.min.js" integrity="sha512-8qmis31OQi6hIRgvkht0s6mCOittjMa9GMqtK9hes5iEQBQE/Ca6yGE5FsW36vyipGoWQswBj/QBm2JR086Rkw==" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.4.1/highlight.min.js" integrity="sha512-DrpaExP2d7RJqNhXB41Q/zzzQrtb6J0zfnXD5XeVEWE8d9Hj54irCLj6dRS3eNepPja7DvKcV+9PnHC7A/g83A==" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.4.1/languages/java.min.js" integrity="sha512-ku64EPM6PjpseXTZbyRs0ZfXSbVsmLe+XcXxO3tZf1zW2GxZ+aKH9LZWgl/CRI9AFkU3IL7Pc1mzcZiUuvk7FQ==" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.4.1/languages/bash.min.js" integrity="sha512-Hg0ufGEvn0AuzKMU0psJ1iH238iUN6THh7EI0CfA0n1sd3yu6PYet4SaDMpgzN9L1yQHxfB3yc5ezw3PwolIfA==" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.4.1/languages/json.min.js" integrity="sha512-37sW1XqaJmseHAGNg4N4Y01u6g2do6LZL8tsziiL5CMXGy04Th65OXROw2jeDeXLo5+4Fsx7pmhEJJw77htBFg==" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.4.1/languages/dockerfile.min.js" integrity="sha512-eRNl3ty7GOJPBN53nxLgtSSj2rkYj5/W0Vg0MFQBw8xAoILeT6byOogENHHCRRvHil4pKQ/HbgeJ5DOwQK3SJA==" crossorigin="anonymous"></script>
    <script>if (!(window.minisite || {}).skipHighlightJs) { hljs.initHighlightingOnLoad(); }</script>
    <script src="//yupiik.github.io/bundlebee/js/minisite.js?v=1.0.1-SNAPSHOT"></script>
    <script>$('.page-content-body').generatedNavMenu();</script>
    <script>
            document.querySelector('div.site-logo > a').href =
              document.location.pathname.indexOf('/bundlebee') == 0 ? '/bundlebee/index.html' : '/index.html';
            </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.3/fuse.min.js" integrity="sha512-neoBxVNv0UMXjoilAYGxfWrSsW6iAVclx7vQKdPJ9Peet1bM5YQjU0aIB8LtH8iNPa+pAyMZprBBw2ZQ/Q1LjQ==" crossorigin="anonymous"></script>

</body>
</html>
