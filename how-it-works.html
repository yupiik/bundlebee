<!DOCTYPE html>
<html lang="en">

<head>
    <title>How it works</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A light Java Kubernetes package manager.">
    <meta name="author" content="Yupiik Minisite Generator">
    <meta name="generator" content="Yupiik Minisite Generator">
    
    <link rel="shortcut icon" href="//www.yupiik.io/bundlebee/images/logo.svg">

    <link href="//fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,700,700i|Montserrat:300,400,500,700" rel="stylesheet">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" crossorigin="anonymous" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/asciidoctor.js/1.5.5-5/css/asciidoctor.min.css" integrity="sha512-kI7tn5cuEg16kMeXnYmg8rEJPxbxzEM7Gsr191iQdLDevFBLXPCSU9aZWSVuP61tMZWU3nBAR1cJ7SmXnOGLZw==" crossorigin="anonymous" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.3/css/bootstrap.min.css" integrity="sha512-oc9+XSs1H243/FRN9Rw62Fn8EtxjEYWHXRvjS43YtueEewbS6ObfXcJNyohjHqVKFPoXXUxwc+q1K7Dee6vv9g==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.1/styles/vs2015.min.css" integrity="sha512-w8aclkBlN3Ha08SMwFKXFJqhSUx2qlvTBFLLelF8sm4xQnlg64qmGB/A6pBIKy0W8Bo51yDMDtQiPLNRq1WMcQ==" crossorigin="anonymous" />
    
    <link id="theme-style" rel="stylesheet" href="//www.yupiik.io/bundlebee/css/theme.css?v=1.0.27-SNAPSHOT">
</head>
<body>
    <header class="header fixed-top">
        <div class="branding docs-branding">
            <div class="container-fluid position-relative py-2">
                <div class="docs-logo-wrapper">
	                <div class="site-logo"><a title="Home" class="navbar-brand" href="//www.yupiik.io/bundlebee/index.html">
	                <img class="logo-icon mr-2" src="//www.yupiik.io/bundlebee/images/logo.svg" alt="logo">
	                <span class="logo-text">Yupiik BundleBee <span class="text-alt">Docs</span></span></a></div>
                </div>
	            <div class="docs-top-utilities d-flex justify-content-end align-items-center">
					
					<li class="list-inline-item"><a title="Search" id="search-button" href="#" data-toggle="modal" data-target="#searchModal"><i data-toggle="tooltip" data-placement="top" title="Search" class="fas fa-search"></i></a></li>

					<ul class="social-list list-inline mx-md-3 mx-lg-5 mb-0 d-none d-lg-flex">
						
						<li class="list-inline-item"><a title="Github" href="https://www.github.com/yupiik/"><i class="fab fa-github fa-fw"></i></a></li><li class="list-inline-item"><a title="LinkedIn" href="https://www.linkedin.com/company/yupiik/"><i class="fab fa-linkedin fa-fw"></i></a></li>
		            </ul>
	            </div>
            </div>
        </div>
    </header>
	<div class="page">
        <div class="page-navigation-left">
            <h3>Menu</h3>
            <ul>
                <li>
                    <a title="Getting Started" href="//www.yupiik.io/bundlebee/getting-started.html">
                        <i class="fas fa-play"></i>Getting Started
                    </a>
                </li>                <li>
                    <a title="How it works" href="//www.yupiik.io/bundlebee/how-it-works.html">
                        <i class="fas fa-car-battery"></i>How it works
                    </a>
                </li>                <li>
                    <a title="Available commands" href="//www.yupiik.io/bundlebee/commands.html">
                        <i class="fas fa-terminal"></i>Commands
                    </a>
                </li>                <li>
                    <a title="Available Alveoli" href="//www.yupiik.io/bundlebee/alveoli.html">
                        <i class="fas fa-puzzle-piece"></i>Alveoli
                    </a>
                </li>                <li>
                    <a title="BundleBee Maven Plugin" href="//www.yupiik.io/bundlebee/maven-plugin.html">
                        <i class="fas fa-building"></i>Maven Plugin
                    </a>
                </li>
            </ul>
        </div>

        <div id="how-it-works-html-container" class="container page-content how-it-works-html">
                        <div class="page-header">
                <h1>How it works</h1>
            </div>
            <div class="page-content-body">
                <div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
BundleBee is a light Java package manager for Kubernetes applications.
This page explains how to get started with it.
</blockquote>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overall_architecture">Overall architecture</h2>
<div class="sectionbody">
<div class="paragraph">
<p>One of the BundleBee goals is to inherit from the well known and supported Apache Maven infrastructure.
In other words, the goal is to be able to reuse Maven registries (central, custom nexus, artifactory, &#8230;&#8203;) to store application descriptors.
It also leverage the well know java packaging (jar or zip) to ensure a strong storage reliability in these systems.</p>
</div>
<div class="paragraph">
<p>One direct benefit is that it becomes very easy to have an immutable system once deployed and therefore a better tracability of what is deployed.</p>
</div>
<div class="paragraph">
<p>Overall, BundleBee will manipulate what we call <code>alveolus</code> which are basically just a set of descriptors.
An <code>alveolus</code> is a zip or a jar which is structured this way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">.root
 `- bundlebee <b class="conum">(1)</b>
      |- manifest.json <b class="conum">(2)</b>
      `- kubernetes <b class="conum">(3)</b>
           |- my-descriptor-1.yaml
           `- my-descriptor-2.yaml</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>A <code>bundlebee</code> folder contains all the descriptors</p>
</li>
<li>
<p>A <code>manifest.json</code> contains the list of application or library this alveolus provides</p>
</li>
<li>
<p>A <code>kubenetes</code> folder contains the list of descriptors used by alveoli</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_manifest">Manifest</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Manifest is the central point of the system.
It provides the unique identifier of your recipe (application/library) and what to do to set it up.</p>
</div>
<div class="paragraph">
<p>Here is its configuration specification:</p>
</div>
<div class="sect2">
<h3 id="_manifest_descriptor">Manifest Descriptor</h3>
<div class="paragraph">
<p>BundleBee manifest descriptor.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Manifest Descriptor</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">JSON Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">interpolateAlveoli</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>interpolateAlveoli</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables to consider all alveoli have their <code>interpolateDescriptors</code> descriptor set to <code>true</code>, you can still set it to <code>false</code> if you want to disable it for one.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#io_yupiik_bundlebee_core_descriptor_Manifest_Alveolus">Manifest.alveoli</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>alveoli</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">array of object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of described applications/libraries.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#io_yupiik_bundlebee_core_descriptor_Manifest_IgnoredLintingRule">Manifest.ignoredLintingRules</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ignoredLintingRules</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">array of object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ignored linting rule names when using <code>lint</code> command.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#io_yupiik_bundlebee_core_descriptor_Manifest_ManifestReference">Manifest.references</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>references</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">array of object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of files referenced as other manifests. They are merged with this (main) manifest by <strong>appending</strong> <em>requirements</em> and <em>alveoli</em>. It is relative to this manifest location. Important: it is only about the same module references, external references are dependencies in an alveoli. It enables to split a huge <code>manifest.json</code> for an easier maintenance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#io_yupiik_bundlebee_core_descriptor_Manifest_Requirement">Manifest.requirements</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>requirements</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">array of object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pre manifest execution checks (bundlebee version typically). Avoids to install using a bundlebee version not compatible with the alveoli. Can be fully omitted.</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="io_yupiik_bundlebee_core_descriptor_Manifest_Alveolus">Manifest.alveoli</h4>
<div class="paragraph">
<p>List of described applications/libraries.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Manifest.alveoli</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">JSON Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">chainDependencies</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>chainDependencies</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should dependencies be installed one after the other or in parallel (default). It is useful when you install a namespace for example which must be awaited before next dependencies are installed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">interpolateDescriptors</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>interpolateDescriptors</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables to consider all descriptors have their <code>interpolate</code> descriptor set to <code>true</code>, you can still set it to <code>false</code> if you want to disable it for one. If not set, <code>interpolateAlveoli</code> flag from the manifest.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the alveolus (recipe). It must be unique accross the whole classpath. Using maven style identifier, it is recommended to name it <code>&lt;groupId&gt;:&lt;artifactId&gt;:&lt;version&gt;</code> using maven filtering but it is not enforced.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If name does not follow <code>&lt;groupId&gt;:&lt;artifactId&gt;:&lt;version&gt;</code> naming (i.e. version can&#8217;t be extracted from the name) then you can specify the version there. Note that if set, this is used in priority (explicit versus deduced).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#io_yupiik_bundlebee_core_descriptor_Manifest_AlveolusDependency">Alveolus.dependencies</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dependencies</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">array of object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dependencies of this alveolus. It is a way to import transitively a set of descriptors.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#io_yupiik_bundlebee_core_descriptor_Manifest_Descriptor">Alveolus.descriptors</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>descriptors</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">array of object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of descriptors to install for this alveolus. This is required even if an empty array.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#io_yupiik_bundlebee_core_descriptor_Manifest_DescriptorRef">Alveolus.excludedDescriptors</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>excludedDescriptors</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">array of object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of descriptors to ignore for this alveolus (generally coming from dependencies).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#io_yupiik_bundlebee_core_descriptor_Manifest_Patch">Alveolus.patches</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>patches</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">array of object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Patches on descriptors. It enables to inject configuration in descriptors by patching (using JSON-Patch or plain interpolation with <code>${key}</code> values) their JSON representation. The key is the descriptor name and each time the descriptor is found it will be applied.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">placeholders</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>placeholders</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Local placeholders for this particular alveolus and its dependencies. It is primarly intended to be able to create a template alveolus and inject the placeholders inline.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="io_yupiik_bundlebee_core_descriptor_Manifest_AlveolusDependency">Alveolus.dependencies</h4>
<div class="paragraph">
<p>Dependencies of this alveolus. It is a way to import transitively a set of descriptors.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Alveolus.dependencies</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">JSON Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">location</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>location</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Where to find the alveolus. Note it will ensure the jar is present on the local maven repository.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alveolus name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#io_yupiik_bundlebee_core_descriptor_Manifest_Conditions">Descriptor.includeIf</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>includeIf</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conditions to include this dependency. Enables for example to have an environment variable enabling part of the stack (ex: <code>MONITORING=true</code>)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="io_yupiik_bundlebee_core_descriptor_Manifest_Descriptor">Alveolus.descriptors</h4>
<div class="paragraph">
<p>List of descriptors to install for this alveolus. This is required even if an empty array.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Alveolus.descriptors</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">JSON Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">await</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>await</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to <code>true</code>, apply/delete commands will await the actual creation of the resource (<code>GET /x</code> returns a HTTP 200) before continuing to process next resources. It is useful for namespaces for example to ensure applications can be created in the newly created namespace. It avoids to run and rerun apply command in practise. For more advanced tests, use <code>awaitConditions</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">awaitOnDelete</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>awaitOnDelete</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">On delete we rarely want to check the resource exists before but in these rare case you can set this toggle to <code>true</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">interpolate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>interpolate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to <code>true</code>, it will interpolate the descriptor just before applying it - i.e. after it had been patched if needed. You can use <code>--&lt;config-key&gt; &lt;value&gt;</code> to inject bindings set as <code>{{config-key:-default value}}</code>. If not set, <code>interpolateDescriptors</code> flag from the alveolus will be used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">location</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>location</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional, if coming from another manifest, the dependency to download to get the alveolus.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the descriptor to install. For kubernetes descriptors you can omit the <code>.yaml</code> extension.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type of this descriptor. For now only <code>kubernetes</code> is supported. It also defines in which folder under <code>bundlebee</code> the descriptor(s) are looked for from its name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#io_yupiik_bundlebee_core_descriptor_Manifest_AwaitConditions">Descriptor.awaitConditions</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>awaitConditions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">array of object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Test to do on created/destroyed resources, enables to synchronize and await kubernetes actually starts some resource. For <code>apply</code> and <code>delete</code> commands, <code>descriptorAwaitTimeout</code> is still applied. Note that if you use multiple array entries for the same command it will be evaluated with an <code>AND</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#io_yupiik_bundlebee_core_descriptor_Manifest_Conditions">Descriptor.includeIf</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>includeIf</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conditions to include this descriptor.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="io_yupiik_bundlebee_core_descriptor_Manifest_Conditions">Descriptor.includeIf</h4>
<div class="paragraph">
<p>Conditions to include this descriptor.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Descriptor.includeIf</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">JSON Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>operator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operator to combine the conditions. Potential values: <code>ANY</code> (At least one condition must match.),<code>ALL</code> (All conditions must match.).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#io_yupiik_bundlebee_core_descriptor_Manifest_Condition">Conditions.conditions</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>conditions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">array of object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of condition to match according <code>operator</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="io_yupiik_bundlebee_core_descriptor_Manifest_Condition">Conditions.conditions</h4>
<div class="paragraph">
<p>List of condition to match according <code>operator</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Conditions.conditions</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">JSON Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Expected key. If empty/null condition is ignored. If read value is null it defaults to an empty string.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">negate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>negate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should the condition be reversed (ie "not in this case").</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type of condition. Potential values: <code>ENV</code> (Key is read is process environment variables.),<code>SYSTEM_PROPERTY</code> (Key is read is process system properties.).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Expected value. If empty/null, <code>true</code> is assumed. Note that empty is allowed.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="io_yupiik_bundlebee_core_descriptor_Manifest_AwaitConditions">Descriptor.awaitConditions</h4>
<div class="paragraph">
<p>Test to do on created/destroyed resources, enables to synchronize and await kubernetes actually starts some resource. For <code>apply</code> and <code>delete</code> commands, <code>descriptorAwaitTimeout</code> is still applied. Note that if you use multiple array entries for the same command it will be evaluated with an <code>AND</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Descriptor.awaitConditions</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">JSON Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">command</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>command</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Command to apply these conditions to, if not set it will be applied on <code>apply</code> command only. Note that for now only <code>apply</code> and <code>delete</code> commands are supported, others will be ignored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>operator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operator to combine the conditions. Potential values: <code>ANY</code> (At least one condition must match.),<code>ALL</code> (All conditions must match.).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#io_yupiik_bundlebee_core_descriptor_Manifest_AwaitCondition">AwaitConditions.conditions</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>conditions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">array of object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of condition to match according <code>operator</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="io_yupiik_bundlebee_core_descriptor_Manifest_AwaitCondition">AwaitConditions.conditions</h4>
<div class="paragraph">
<p>List of condition to match according <code>operator</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. AwaitConditions.conditions</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">JSON Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">conditionType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>conditionType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When condition type is <code>STATUS_CONDITION</code> it is the expected type of the condition. This is ignored when condition type is <code>JSON_POINTER</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>operatorType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The operation to evaluate if this condition is true or not. (for <code>type=JSON_POINTER</code>). Potential values: <code>EXISTS</code> (JSON Pointer exists model.),<code>MISSING</code> (JSON Pointer does not exist in the resource model.),<code>EQUALS</code> (JSON Pointer value is equal to (stringified comparison) value.),<code>NOT_EQUALS</code> (JSON Pointer is different from the provided value.),<code>EQUALS_IGNORE_CASE</code> (JSON Pointer value is equal (ignoring case) to (stringified comparison) value.),<code>NOT_EQUALS_IGNORE_CASE</code> (JSON Pointer is different (ignoring case) from the provided value.),<code>CONTAINS</code> (JSON Pointer contains the configured value.).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pointer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pointer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSON Pointer to read from the resource. It can for example be on <code>/status/phase</code> to await a namespace creation. (for <code>type=JSON_POINTER</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type of condition. Potential values: <code>JSON_POINTER</code> (JSON Pointer evaluation (fully custom).),<code>STATUS_CONDITION</code> (Evaluate items in <code>/status/conditions</code>.).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When condition type is <code>JSON_POINTER</code> and <code>operatorType</code> needs a value (<code>EQUALS</code> for example), the related value. It can be <code>Active</code> if you test namespace <code>/status/phase</code> for example. When condition type is <code>STATUS_CONDITION</code> it is the expected status.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="io_yupiik_bundlebee_core_descriptor_Manifest_DescriptorRef">Alveolus.excludedDescriptors</h4>
<div class="paragraph">
<p>List of descriptors to ignore for this alveolus (generally coming from dependencies).</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. Alveolus.excludedDescriptors</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">JSON Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">location</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>location</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The container of the descriptor (maven coordinates generally).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the descriptor (as declared, ie potentially without the extension).</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="io_yupiik_bundlebee_core_descriptor_Manifest_Patch">Alveolus.patches</h4>
<div class="paragraph">
<p>Patches on descriptors. It enables to inject configuration in descriptors by patching (using JSON-Patch or plain interpolation with <code>${key}</code> values) their JSON representation. The key is the descriptor name and each time the descriptor is found it will be applied.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. Alveolus.patches</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">JSON Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">descriptorName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>descriptorName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The descriptor to patch. It can be any descriptor, including transitive ones. It can be <code>*</code> to patch all descriptors (<code>/metadata/label/app</code> for example) or <code>regex:&lt;java pattern&gt;</code> to match descriptor names with a regex.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">interpolate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>interpolate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to <code>true</code>, it will interpolate the patch from the execution configuration which means you can use <code>--&lt;config-key&gt; &lt;value&gt;</code> to inject bindings too. An interesting interpolation is the ability to extract the ip/host of the host machine (<code>minikube ip</code> equivalent) using the kubeconfig file. Syntax is the following one: <code>{{kubeconfig.cluster.minikube.ip}}</code> or more generally <code>{{kubeconfig.cluster.&lt;cluster name&gt;.ip}}</code>. You can also await for some secret with this syntax <code>{{kubernetes.&lt;namespace&gt;.serviceaccount.&lt;account name&gt;.secrets.&lt;secret name prefix&gt;.data.&lt;entry name&gt;[.&lt;timeout in seconds, default to 2mn&gt;]}}</code>. This is particular useful to access freshly created service account tokens for example.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">patch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>patch</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">array of object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSON-Patch to apply on the JSON representation of the descriptor. It enables to inject configuration in descriptors for example, or changing some name/application.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#io_yupiik_bundlebee_core_descriptor_Manifest_Conditions">Descriptor.includeIf</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>includeIf</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conditions to include this patch. Enables for example to have an environment variable enabling part of the stack (ex: <code>MONITORING=true</code>)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="io_yupiik_bundlebee_core_descriptor_Manifest_IgnoredLintingRule">Manifest.ignoredLintingRules</h4>
<div class="paragraph">
<p>Ignored linting rule names when using <code>lint</code> command.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 11. Manifest.ignoredLintingRules</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">JSON Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the rule to ignore.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="io_yupiik_bundlebee_core_descriptor_Manifest_ManifestReference">Manifest.references</h4>
<div class="paragraph">
<p>List of files referenced as other manifests. They are merged with this (main) manifest by <strong>appending</strong> <em>requirements</em> and <em>alveoli</em>. It is relative to this manifest location. Important: it is only about the same module references, external references are dependencies in an alveoli. It enables to split a huge <code>manifest.json</code> for an easier maintenance.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 12. Manifest.references</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">JSON Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>path</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Relative or absolute - starting by a <code>/</code> - location (referenced to the base directory of <code>manifest.json</code>). For example <code>my-manifest.json</code> will resolve to <code>/path/to/bundlebee/my-manifest.json</code> in a folder and <code>/bundlebee/my-manifest.json</code> in a jar. Important: for resources (jar/classpath), the classloader is used so ensure your name is unique accross your classpath (we recommend you to prefix it with the module name, ex :`/bundlebee/my-module.sub-manifest.json` or use a dedicated subfolder (<code>/bundlebee/my-module/sub.json</code>).</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="io_yupiik_bundlebee_core_descriptor_Manifest_Requirement">Manifest.requirements</h4>
<div class="paragraph">
<p>Pre manifest execution checks (bundlebee version typically). Avoids to install using a bundlebee version not compatible with the alveoli. Can be fully omitted.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 13. Manifest.requirements</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">JSON Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxBundlebeeVersion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>maxBundlebeeVersion</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum bundlebee version, use `*`to replace any digit in a segment. Note that snapshot is ignored in the comparison for convenience. It is an inclusive comparison.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">minBundlebeeVersion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>minBundlebeeVersion</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum bundlebee version, use <code>*</code> to replace any digit in a segment. Note that snapshot is ignored in the comparison for convenience. It is an inclusive comparison.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">forbiddenVersions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>forbiddenVersions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">array of string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of forbidden version (due to a bug or equivalent). Here too snapshot suffix is ignored. <code><strong></code> is usable there too to replace any digit in a segment (ex: <code>1.</strong>.<strong></code>). Note that <code>1.</strong></code> would <strong>NOT</strong> match <code>1.<strong>.</strong></code>, version are always 3 segments.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
manifest content can be wrapped in a <code>bundlebee</code> key (you wrap the whole content) which enables you to add other metadata in the manifest and still reuse BundleeBee JSON-Schema for the validation (by composition).
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_json_schema">JSON-Schema</h3>
<div class="paragraph">
<p>If you use JSON-Schema facilities in your preferred editor, here is the raw JSON-Schema for the manifest descriptor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "$id":"io_yupiik_bundlebee_core_descriptor_Manifest",
  "type":"object",
  "title":"Manifest Descriptor",
  "description":"BundleBee manifest descriptor.",
  "definitions":{
    "io_yupiik_bundlebee_core_descriptor_Manifest_Conditions":{
      "$id":"io_yupiik_bundlebee_core_descriptor_Manifest_Conditions",
      "type":"object",
      "title":"Descriptor.includeIf",
      "description":"Conditions to include this descriptor.",
      "properties":{
        "conditions":{
          "type":"array",
          "title":"Conditions.conditions",
          "description":"List of condition to match according `operator`.",
          "items":{
            "$id":"io_yupiik_bundlebee_core_descriptor_Manifest_Condition",
            "type":"object",
            "properties":{
              "key":{
                "type":"string",
                "title":"Condition.key",
                "description":"Expected key. If empty/null condition is ignored. If read value is null it defaults to an empty string."
              },
              "negate":{
                "type":"boolean",
                "title":"Condition.negate",
                "description":"Should the condition be reversed (ie \"not in this case\")."
              },
              "type":{
                "$id":"io_yupiik_bundlebee_core_descriptor_Manifest_ConditionType",
                "type":"string",
                "title":"Condition.type",
                "description":"Type of condition.",
                "enum":[
                  "ENV",
                  "SYSTEM_PROPERTY"
                ],
                "nullable":true
              },
              "value":{
                "type":"string",
                "title":"Condition.value",
                "description":"Expected value. If empty/null, `true` is assumed. Note that empty is allowed."
              }
            }
          }
        },
        "operator":{
          "$id":"io_yupiik_bundlebee_core_descriptor_Manifest_ConditionOperator",
          "type":"string",
          "title":"Conditions.operator",
          "description":"Operator to combine the conditions.",
          "enum":[
            "ANY",
            "ALL"
          ],
          "nullable":true
        }
      }
    }
  },
  "properties":{
    "alveoli":{
      "type":"array",
      "title":"Manifest.alveoli",
      "description":"List of described applications/libraries.",
      "items":{
        "$id":"io_yupiik_bundlebee_core_descriptor_Manifest_Alveolus",
        "type":"object",
        "properties":{
          "chainDependencies":{
            "type":"boolean",
            "title":"Alveolus.chainDependencies",
            "description":"Should dependencies be installed one after the other or in parallel (default). It is useful when you install a namespace for example which must be awaited before next dependencies are installed."
          },
          "dependencies":{
            "type":"array",
            "title":"Alveolus.dependencies",
            "description":"Dependencies of this alveolus. It is a way to import transitively a set of descriptors.",
            "items":{
              "$id":"io_yupiik_bundlebee_core_descriptor_Manifest_AlveolusDependency",
              "type":"object",
              "properties":{
                "includeIf":{
                  "$ref":"#/definitions/io_yupiik_bundlebee_core_descriptor_Manifest_Conditions",
                  "type":"object",
                  "title":"AlveolusDependency.includeIf",
                  "description":"Conditions to include this dependency. Enables for example to have an environment variable enabling part of the stack (ex: `MONITORING=true`)"
                },
                "location":{
                  "type":"string",
                  "title":"AlveolusDependency.location",
                  "description":"Where to find the alveolus. Note it will ensure the jar is present on the local maven repository."
                },
                "name":{
                  "type":"string",
                  "title":"AlveolusDependency.name",
                  "description":"Alveolus name."
                }
              }
            }
          },
          "descriptors":{
            "type":"array",
            "title":"Alveolus.descriptors",
            "description":"List of descriptors to install for this alveolus. This is required even if an empty array.",
            "items":{
              "$id":"io_yupiik_bundlebee_core_descriptor_Manifest_Descriptor",
              "type":"object",
              "properties":{
                "await":{
                  "type":"boolean",
                  "title":"Descriptor.await",
                  "description":"If set to `true`, apply/delete commands will await the actual creation of the resource (`GET /x` returns a HTTP 200) before continuing to process next resources. It is useful for namespaces for example to ensure applications can be created in the newly created namespace. It avoids to run and rerun apply command in practise. For more advanced tests, use `awaitConditions`."
                },
                "awaitConditions":{
                  "type":"array",
                  "title":"Descriptor.awaitConditions",
                  "description":"Test to do on created/destroyed resources, enables to synchronize and await kubernetes actually starts some resource. For `apply` and `delete` commands, `descriptorAwaitTimeout` is still applied. Note that if you use multiple array entries for the same command it will be evaluated with an `AND`.",
                  "items":{
                    "$id":"io_yupiik_bundlebee_core_descriptor_Manifest_AwaitConditions",
                    "type":"object",
                    "properties":{
                      "command":{
                        "type":"string",
                        "title":"AwaitConditions.command",
                        "description":"Command to apply these conditions to, if not set it will be applied on `apply` command only. Note that for now only `apply` and `delete` commands are supported, others will be ignored."
                      },
                      "conditions":{
                        "type":"array",
                        "title":"AwaitConditions.conditions",
                        "description":"List of condition to match according `operator`.",
                        "items":{
                          "$id":"io_yupiik_bundlebee_core_descriptor_Manifest_AwaitCondition",
                          "type":"object",
                          "properties":{
                            "conditionType":{
                              "type":"string",
                              "title":"AwaitCondition.conditionType",
                              "description":"When condition type is `STATUS_CONDITION` it is the expected type of the condition. This is ignored when condition type is `JSON_POINTER`."
                            },
                            "operatorType":{
                              "$id":"io_yupiik_bundlebee_core_descriptor_Manifest_JsonPointerOperator",
                              "type":"string",
                              "title":"AwaitCondition.operatorType",
                              "description":"The operation to evaluate if this condition is true or not. (for `type=JSON_POINTER`).",
                              "enum":[
                                "EXISTS",
                                "MISSING",
                                "EQUALS",
                                "NOT_EQUALS",
                                "EQUALS_IGNORE_CASE",
                                "NOT_EQUALS_IGNORE_CASE",
                                "CONTAINS"
                              ],
                              "nullable":true
                            },
                            "pointer":{
                              "type":"string",
                              "title":"AwaitCondition.pointer",
                              "description":"JSON Pointer to read from the resource. It can for example be on `/status/phase` to await a namespace creation. (for `type=JSON_POINTER`)."
                            },
                            "type":{
                              "$id":"io_yupiik_bundlebee_core_descriptor_Manifest_AwaitConditionType",
                              "type":"string",
                              "title":"AwaitCondition.type",
                              "description":"Type of condition.",
                              "enum":[
                                "JSON_POINTER",
                                "STATUS_CONDITION"
                              ],
                              "nullable":true
                            },
                            "value":{
                              "type":"string",
                              "title":"AwaitCondition.value",
                              "description":"When condition type is `JSON_POINTER` and `operatorType` needs a value (`EQUALS` for example), the related value. It can be `Active` if you test namespace `/status/phase` for example. When condition type is `STATUS_CONDITION` it is the expected status."
                            }
                          }
                        }
                      },
                      "operator":{
                        "$id":"io_yupiik_bundlebee_core_descriptor_Manifest_ConditionOperator",
                        "type":"string",
                        "title":"AwaitConditions.operator",
                        "description":"Operator to combine the conditions.",
                        "enum":[
                          "ANY",
                          "ALL"
                        ],
                        "nullable":true
                      }
                    }
                  }
                },
                "awaitOnDelete":{
                  "type":"boolean",
                  "title":"Descriptor.awaitOnDelete",
                  "description":"On delete we rarely want to check the resource exists before but in these rare case you can set this toggle to `true`."
                },
                "includeIf":{
                  "$id":"io_yupiik_bundlebee_core_descriptor_Manifest_Conditions",
                  "type":"object",
                  "title":"Descriptor.includeIf",
                  "description":"Conditions to include this descriptor.",
                  "properties":{
                    "conditions":{
                      "type":"array",
                      "title":"Conditions.conditions",
                      "description":"List of condition to match according `operator`.",
                      "items":{
                        "$id":"io_yupiik_bundlebee_core_descriptor_Manifest_Condition",
                        "type":"object",
                        "properties":{
                          "key":{
                            "type":"string",
                            "title":"Condition.key",
                            "description":"Expected key. If empty/null condition is ignored. If read value is null it defaults to an empty string."
                          },
                          "negate":{
                            "type":"boolean",
                            "title":"Condition.negate",
                            "description":"Should the condition be reversed (ie \"not in this case\")."
                          },
                          "type":{
                            "$id":"io_yupiik_bundlebee_core_descriptor_Manifest_ConditionType",
                            "type":"string",
                            "title":"Condition.type",
                            "description":"Type of condition.",
                            "enum":[
                              "ENV",
                              "SYSTEM_PROPERTY"
                            ],
                            "nullable":true
                          },
                          "value":{
                            "type":"string",
                            "title":"Condition.value",
                            "description":"Expected value. If empty/null, `true` is assumed. Note that empty is allowed."
                          }
                        }
                      }
                    },
                    "operator":{
                      "$id":"io_yupiik_bundlebee_core_descriptor_Manifest_ConditionOperator",
                      "type":"string",
                      "title":"Conditions.operator",
                      "description":"Operator to combine the conditions.",
                      "enum":[
                        "ANY",
                        "ALL"
                      ],
                      "nullable":true
                    }
                  }
                },
                "interpolate":{
                  "type":"boolean",
                  "title":"Descriptor.interpolate",
                  "description":"If set to `true`, it will interpolate the descriptor just before applying it - i.e. after it had been patched if needed. You can use `--&lt;config-key&gt; &lt;value&gt;` to inject bindings set as `{{config-key:-default value}}`. If not set, `interpolateDescriptors` flag from the alveolus will be used.",
                  "nullable":true
                },
                "location":{
                  "type":"string",
                  "title":"Descriptor.location",
                  "description":"Optional, if coming from another manifest, the dependency to download to get the alveolus."
                },
                "name":{
                  "type":"string",
                  "title":"Descriptor.name",
                  "description":"Name of the descriptor to install. For kubernetes descriptors you can omit the `.yaml` extension."
                },
                "type":{
                  "type":"string",
                  "title":"Descriptor.type",
                  "description":"Type of this descriptor. For now only `kubernetes` is supported. It also defines in which folder under `bundlebee` the descriptor(s) are looked for from its name."
                }
              }
            }
          },
          "excludedDescriptors":{
            "type":"array",
            "title":"Alveolus.excludedDescriptors",
            "description":"List of descriptors to ignore for this alveolus (generally coming from dependencies).",
            "items":{
              "$id":"io_yupiik_bundlebee_core_descriptor_Manifest_DescriptorRef",
              "type":"object",
              "properties":{
                "location":{
                  "type":"string",
                  "title":"DescriptorRef.location",
                  "description":"The container of the descriptor (maven coordinates generally)."
                },
                "name":{
                  "type":"string",
                  "title":"DescriptorRef.name",
                  "description":"Name of the descriptor (as declared, ie potentially without the extension)."
                }
              }
            }
          },
          "interpolateDescriptors":{
            "type":"boolean",
            "title":"Alveolus.interpolateDescriptors",
            "description":"Enables to consider all descriptors have their `interpolate` descriptor set to `true`, you can still set it to `false` if you want to disable it for one. If not set, `interpolateAlveoli` flag from the manifest.",
            "nullable":true
          },
          "name":{
            "type":"string",
            "title":"Alveolus.name",
            "description":"Name of the alveolus (recipe). It must be unique accross the whole classpath. Using maven style identifier, it is recommended to name it `&lt;groupId&gt;:&lt;artifactId&gt;:&lt;version&gt;` using maven filtering but it is not enforced."
          },
          "patches":{
            "type":"array",
            "title":"Alveolus.patches",
            "description":"Patches on descriptors. It enables to inject configuration in descriptors by patching (using JSON-Patch or plain interpolation with `${key}` values) their JSON representation. The key is the descriptor name and each time the descriptor is found it will be applied.",
            "items":{
              "$id":"io_yupiik_bundlebee_core_descriptor_Manifest_Patch",
              "type":"object",
              "properties":{
                "descriptorName":{
                  "type":"string",
                  "title":"Patch.descriptorName",
                  "description":"The descriptor to patch. It can be any descriptor, including transitive ones. It can be `*` to patch all descriptors (`/metadata/label/app` for example) or `regex:&lt;java pattern&gt;` to match descriptor names with a regex."
                },
                "includeIf":{
                  "$ref":"#/definitions/io_yupiik_bundlebee_core_descriptor_Manifest_Conditions",
                  "type":"object",
                  "title":"Patch.includeIf",
                  "description":"Conditions to include this patch. Enables for example to have an environment variable enabling part of the stack (ex: `MONITORING=true`)"
                },
                "interpolate":{
                  "type":"boolean",
                  "title":"Patch.interpolate",
                  "description":"If set to `true`, it will interpolate the patch from the execution configuration which means you can use `--&lt;config-key&gt; &lt;value&gt;` to inject bindings too. An interesting interpolation is the ability to extract the ip/host of the host machine (`minikube ip` equivalent) using the kubeconfig file. Syntax is the following one: `{{kubeconfig.cluster.minikube.ip}}` or more generally `{{kubeconfig.cluster.&lt;cluster name&gt;.ip}}`. You can also await for some secret with this syntax `{{kubernetes.&lt;namespace&gt;.serviceaccount.&lt;account name&gt;.secrets.&lt;secret name prefix&gt;.data.&lt;entry name&gt;[.&lt;timeout in seconds, default to 2mn&gt;]}}`. This is particular useful to access freshly created service account tokens for example."
                },
                "patch":{
                  "type":"array",
                  "title":"Patch.patch",
                  "description":"JSON-Patch to apply on the JSON representation of the descriptor. It enables to inject configuration in descriptors for example, or changing some name/application.",
                  "items":{
                    "type":"object",
                    "properties":{

                    }
                  }
                }
              }
            }
          },
          "placeholders":{
            "type":"object",
            "title":"Alveolus.placeholders",
            "description":"Local placeholders for this particular alveolus and its dependencies. It is primarly intended to be able to create a template alveolus and inject the placeholders inline.",
            "properties":{

            }
          },
          "version":{
            "type":"string",
            "title":"Alveolus.version",
            "description":"If name does not follow `&lt;groupId&gt;:&lt;artifactId&gt;:&lt;version&gt;` naming (i.e. version can't be extracted from the name) then you can specify the version there. Note that if set, this is used in priority (explicit versus deduced)."
          }
        }
      }
    },
    "ignoredLintingRules":{
      "type":"array",
      "title":"Manifest.ignoredLintingRules",
      "description":"Ignored linting rule names when using `lint` command.",
      "items":{
        "$id":"io_yupiik_bundlebee_core_descriptor_Manifest_IgnoredLintingRule",
        "type":"object",
        "properties":{
          "name":{
            "type":"string",
            "title":"IgnoredLintingRule.name",
            "description":"Name of the rule to ignore."
          }
        }
      }
    },
    "interpolateAlveoli":{
      "type":"boolean",
      "title":"Manifest.interpolateAlveoli",
      "description":"Enables to consider all alveoli have their `interpolateDescriptors` descriptor set to `true`, you can still set it to `false` if you want to disable it for one.",
      "nullable":true
    },
    "references":{
      "type":"array",
      "title":"Manifest.references",
      "description":"List of files referenced as other manifests. They are merged with this (main) manifest by *appending* _requirements_ and _alveoli_. It is relative to this manifest location. Important: it is only about the same module references, external references are dependencies in an alveoli. It enables to split a huge `manifest.json` for an easier maintenance.",
      "items":{
        "$id":"io_yupiik_bundlebee_core_descriptor_Manifest_ManifestReference",
        "type":"object",
        "properties":{
          "path":{
            "type":"string",
            "title":"ManifestReference.path",
            "description":"Relative or absolute - starting by a `/` - location (referenced to the base directory of `manifest.json`). For example `my-manifest.json` will resolve to `/path/to/bundlebee/my-manifest.json` in a folder and `/bundlebee/my-manifest.json` in a jar. Important: for resources (jar/classpath), the classloader is used so ensure your name is unique accross your classpath (we recommend you to prefix it with the module name, ex :`/bundlebee/my-module.sub-manifest.json` or use a dedicated subfolder (`/bundlebee/my-module/sub.json`)."
          }
        }
      }
    },
    "requirements":{
      "type":"array",
      "title":"Manifest.requirements",
      "description":"Pre manifest execution checks (bundlebee version typically). Avoids to install using a bundlebee version not compatible with the alveoli. Can be fully omitted.",
      "items":{
        "$id":"io_yupiik_bundlebee_core_descriptor_Manifest_Requirement",
        "type":"object",
        "properties":{
          "forbiddenVersions":{
            "type":"array",
            "title":"Requirement.forbiddenVersions",
            "description":"List of forbidden version (due to a bug or equivalent). Here too snapshot suffix is ignored. `*` is usable there too to replace any digit in a segment (ex: `1.*.*`). Note that `1.*` would *NOT* match `1.*.*`, version are always 3 segments.",
            "items":{
              "type":"string"
            }
          },
          "maxBundlebeeVersion":{
            "type":"string",
            "title":"Requirement.maxBundlebeeVersion",
            "description":"Minimum bundlebee version, use `*`to replace any digit in a segment. Note that snapshot is ignored in the comparison for convenience. It is an inclusive comparison."
          },
          "minBundlebeeVersion":{
            "type":"string",
            "title":"Requirement.minBundlebeeVersion",
            "description":"Minimum bundlebee version, use `*` to replace any digit in a segment. Note that snapshot is ignored in the comparison for convenience. It is an inclusive comparison."
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
you can also use last version from <a href="https://raw.githubusercontent.com/yupiik/bundlebee/gh-pages/generated/jsonschema/manifest.descriptor.json">this link</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_deployment_and_dependency_management">Deployment and Dependency Management</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A manifest can reference descriptors in other alveoli, it just requires to reference them to let bundlebee find them.</p>
</div>
<div class="paragraph">
<p>There are mainly two ways to deploy an alveolus:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Classpath mode: you put all your zip/jar in the classpath. This mode requires there is no conflict between descriptor names (which is the recommended practise) and it will never look for external descriptors.
It is typically a recommended mode to avoid network I/O except with the Kubernetes cluster.</p>
</li>
<li>
<p>Fetch mode: in this mode, a missing descriptor in the classpath will look for <code>descriptor.location</code> and lookup the jar/zip referenced by this location (generally a maven coordinate in the form <code>groupId:artifactId:version</code>).
It will first use your local Maven repository but can download the jar/zip if missing locally.
Then the jar/zip is read and descriptors are looked up from there.
This mode is nicer when depending on a lot of external alveoli but requires I/O to grab the dependencies.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customize_descriptors">Customize descriptors</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Indeed, you can bundle all your stack and hardcode your configuration or create one alveolus per environment.
This is one option which works well and enable to version its configuration.</p>
</div>
<div class="paragraph">
<p>However, for testing purposes, it is also neat to be able to patch descriptors on the fly.
For that you can use <code>descriptor.patches</code> in the manifest which will transitively enable to patch the descriptors - even the ones you don&#8217;t own - using JSON-Patch and interpolations.</p>
</div>
<div class="paragraph">
<p>Here are some examples.</p>
</div>
<div class="listingblock">
<div class="title">Patch using CLI option</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "alveoli": [
    {
      "name": "com.company.alveoli:my-app:${project.version}",
      "descriptors": [
        {
          "name": "com.company.alveoli_my-app.configmap"
        },
        // ...
      ],
      "patches": [ <b class="conum">(1)</b>
        "descriptorName": "com.company.other_alveolus.configmap", <b class="conum">(2)</b>
        "interpolate": true, <b class="conum">(3)</b>
        "patch": [ <b class="conum">(4)</b>
          {
            "op": "replace",
            "path": "data",
            "value": {
              "my.config.value": "{{my.arg:-defaultValue}}" <b class="conum">(5)</b>
            }
          }
        ]
      ]
    }
  ]
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>We add to the alveolus a list of patches to apply on some descriptors</p>
</li>
<li>
<p>We reference the descriptor to patch</p>
</li>
<li>
<p>We enable interpolation from Microprofile Config (which include CLI args)</p>
</li>
<li>
<p>We define the JSON-Patch to use (optional, interpolation will also interpolate the descriptor if designed to be interpolated)</p>
</li>
<li>
<p>We use an interpolation in the configuration in the JSON-Patch <code>replace</code> operation which replaces the data of the referenced <code>ConfigMap</code></p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
this mecanism is very useful for <code>ConfigMap</code> descriptors but also <code>PersistenceVolume</code> since you can now patch `/spec/hostPath `easily too.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_deploy_a_dependency_or_descriptor_conditionally">Deploy a dependency (or descriptor) conditionally</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In some case it can be neat to be able to not deploy part of the stack.
It is typically the case when you wrote a monitoring-full alveolus (ie with some optional services functionally).
In such a case you can condition dependencies and descriptor deployment:</p>
</div>
<div class="listingblock">
<div class="title">Deploy monitoring alveolus only if MONITORING option is set</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "alveoli": [
    {
      "name": "com.company.alveoli:my-app:${project.version}",
      "dependencies": [
        {
          "name": "io.yupiik.alveoli:monitoring-alveolus:${bundlebee.version}",
          "location": "io.yupiik.alveoli:monitoring-alveolus:${bundlebee.version}",
          "includeIf": {
            "conditions": [{
              "key": "MONITORING",
              "value": "true"
            }]
          }
        }
      ]
    }
  ]
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
used on descriptors and using a complete set of conditions for descriptors you can handle environments this way (<code>ENV=preprod</code> for descriptor <code>preprod.configmap</code> for example).
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_filter_manifest_at_command_time">Filter manifest at command time</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In some case it can be needed to evaluate some values of the manifest when executing the command.
Even if not recommended it can be done using <code>{{xxx}}</code> placeholders - read from environment variables and system properties.</p>
</div>
<div class="listingblock">
<div class="title">Filter manifest.json at command time</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "alveoli": [
    {
      "name": "com.company.alveoli:my-app:{{project.version}}",
      "dependencies": [
        {
          "name": "io.yupiik.alveoli:monitoring-alveolus:{{bundlebee.version}}",
          "location": "io.yupiik.alveoli:monitoring-alveolus:{{bundlebee.version}}"
        }
      ]
    }
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this manifest you can value <code>project.version</code> and <code>bundlebee.version</code> using the command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">bundlebee \
    [your command and options] \
    --project.version 1.2.1 \
    --bundlebee.version 1.0.1</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_more_placeholders">More placeholders</h3>
<div class="paragraph">
<p>Placeholders can use some keywords to get some particular values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>bundlebee-strip:&lt;value&gt;</code>: strips the provided value,</p>
</li>
<li>
<p><code>bundlebee-strip-leading:&lt;value&gt;</code>: strips the provided value at the beginning,</p>
</li>
<li>
<p><code>bundlebee-strip-trailing:&lt;value&gt;</code>: strips the provided value at the end,</p>
</li>
<li>
<p><code>bundlebee-indent:&lt;indent size&gt;:&lt;value&gt;</code>: indents a value with the provided space size, it is generally combined with another interpolation (file ones in particular) as value, ex <code>{{bundlebee-indent:8:{{bundlebee-inline-file:myfile.txt}}}}</code>,</p>
</li>
<li>
<p><code>bundlebee-inline-file:&lt;file path&gt;</code>: load the file content as value,</p>
</li>
<li>
<p><code>bundlebee-base64-file:&lt;file path&gt;</code>: converts the file in base64 (useful to write <code>data:xxxx,&lt;base64&gt;</code> values for ex keeping the raw file in the filesystem, very helpful for images),</p>
</li>
<li>
<p><code>bundlebee-base64:&lt;text&gt;</code>: encodes in base64 the text,</p>
</li>
<li>
<p><code>bundlebee-digest:BASE64|HEX,&lt;algorithm&gt;,&lt;text&gt;</code>: computes the digest of the text encoded in base64 or hexa format (useful to read files like <code>ConfigMap</code> or <code>Secret</code> and inject their digest value in a <code>Deployment</code> annotations to force its reload for example),</p>
</li>
<li>
<p><code>bundlebee-quote-escaped-inline-file:&lt;file path&gt;</code>: load the file content as a quoted value,</p>
</li>
<li>
<p><code>bundlebee-json-inline-file:&lt;file path&gt;</code>: load the file content as a JSON string value - without quotes,</p>
</li>
<li>
<p><code>bundlebee-json-string:content</code>: escapes a string to be a JSON string (useful when you inject with <code>bundlebee-json-inline-file</code> a string in another string like in JSON <code>ConfigMap</code> in a JSON configuration),</p>
</li>
<li>
<p><code>bundlebee-maven-server-username:&lt;server id&gt;</code>: extract from your maven <code>settings.xml</code> a server username (see configuration for a custom settings.xml location),</p>
</li>
<li>
<p><code>bundlebee-maven-server-password:&lt;server id&gt;</code>: extract from your maven <code>settings.xml</code> a server password (potentially deciphered),</p>
</li>
<li>
<p><code>bundlebee-decipher</code>: use Maven ciphering logic (<code>AES/CBC/PKCS5Padding</code>) to read a clear value. Syntax is as follow <code>{{bundlebee-decipher:$masterKey,$cipheredValue}}</code> with <code>masterKey</code> another <strong>placeholder</strong> name which contains the master key and <code>cipheredValue</code> the value to decipher. Indeed we recommend to reference the master key with another shared placeholder if you use a single one (<code>{{bundlebee-decipher:{{myMasyterKey}},$cipheredValue}}</code>). Last, since the value will be surrounded by <code>{</code> and <code>}</code>, we tolerate spaces before/after to avoid any confusion with the mustable like syntax we use for placeholders: <code>{{bundlebee-decipher:{{my.master.key}}, {&#8230;&#8203;base64&#8230;&#8203;.} }}</code>,</p>
</li>
<li>
<p><code>bundlebee-kubernetes-namespace</code>: the Kubernetes namespace defined in the HttpKubeClient,</p>
</li>
<li>
<p><code>kubeconfig.cluster.&lt;cluster name&gt;.ip</code>: extract cluster IP from your kubeconfig,</p>
</li>
<li>
<p><code>timestamp</code>: current time in milliseconds (since epoch),</p>
</li>
<li>
<p><code>timestampSec</code>: current time in seconds (since epoch),</p>
</li>
<li>
<p><code>now</code>: <code>OffsetDateTime.now()</code> value,</p>
</li>
<li>
<p><code>date:&lt;pattern&gt;</code>: format <code>OffsetDateTime.now()</code> value using the provided pattern,</p>
</li>
<li>
<p><code>nowUTC</code>: <code>OffsetDateTime.now()</code> value with UTC <code>ZoneId</code>,</p>
</li>
<li>
<p><code>kubernetes.&lt;namespace&gt;.serviceaccount.&lt;account name&gt;.secrets.&lt;secret name prefix&gt;.data.&lt;entry name&gt;[.&lt;timeout in seconds&gt;]</code>: secret value looked up through Kubernetes API.</p>
</li>
<li>
<p><code>jsr223:&lt;script path as file or resource or inline script&gt;</code>: executes a JSR223 script to get the result, assumes that the script engine implementation is available in the JVM (not by default). To find the engine it uses the file extension or a comment in the file (for inline script) containing <code>bundlebee.language: &lt;lang&gt;</code>. The script contains the two functions <code>lookupByName</code> and <code>lookupByType</code> which can lookup a CDI bean to reuse BundleBee utilities (ex: <code>const bean = lookupByType.apply(getType('io.yupiik.bundlebee.core.kube.KubeClient'))</code>). If no language is found it defaults on <code>js</code>.</p>
</li>
<li>
<p><code>bundlebee-directory-json-key-value-pairs:/path/to/dir</code>: creates a JSON object from a directory. The path can be either a directory path of a directory path with a glob pattern at the end (<code>/path/to/dir/*.txt</code> for example). The keys are the filenames (simple) and <code><em>__</em></code> are converted to <code>/</code>. The values are the content of the files, filtered. Note it only works with exploded folders, not jar resources as of today.</p>
</li>
<li>
<p><code>bundlebee-directory-json-key-value-pairs-content:/path/to/dir</code>: same as <code>bundlebee-directory-json-key-value-pairs</code> but dropping enclosing brackets to be able to embed the content in an existing object (like <code>annotations</code>). Ex: <code>{{bundlebee-directory-json-key-value-pairs-content:resources/app/annotations/*.txt}}</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If none of these placeholders match, then Microprofile Config is used to lookup the value (so system properties, environment variables and BundleBee args are used).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
file placeholders can also read a resource from the classpath if the path does not match any existing file.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_windows_and_cli">Windows and CLI</h2>
<div class="sectionbody">
<div class="paragraph">
<p>On windows, the usage of the Java mode is recommended and the most reliable, however, if you want to speed up a bit the execution you can run the native bundlebee executable in a docker image.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
ensure to test this solution <strong>on your machine</strong>, on our test machine gain can be x2 but it depends the docker setup too.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once done you would be able to replace <code>bundlebee</code> by <code>docker run bundlebee -v $HOME/.kube/config:/kube/config -e KUBECONFIG=/kube/config --network host</code> (use an alias ;)).</p>
</div>
<div class="paragraph">
<p>Here are the step to use this solution:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download bundlebee native binary, for that go on <a href="https://repo.maven.apache.org/maven2/io/yupiik/bundlebee-core/" class="bare">https://repo.maven.apache.org/maven2/io/yupiik/bundlebee-core/</a>, select the version you want and download the file ending with <code>Linux-amd64</code>,</p>
</li>
<li>
<p>Create this <code>Dockerfile</code> file next to the binary you just downloaded and renamed <code>bundlebee</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-lang="dockerfile">FROM ubuntu:20.10 as builder

RUN apt-get update &amp;&amp; apt-get install -y zlib1g libgcc-s1 libstdc++6

FROM scratch

ENV LD_LIBRARY_PATH /lib

COPY --from=builder /lib/x86_64-linux-gnu/libc.so.6 /lib/libc.so.6
COPY --from=builder /lib/x86_64-linux-gnu/libgcc_s.so.1 /lib/libgcc_s.so.1
COPY --from=builder /lib/x86_64-linux-gnu/libstdc++.so.6.0.28 /lib/libstdc++.so.6
COPY --from=builder /lib/x86_64-linux-gnu/libpthread.so.0 /lib/libpthread.so.0
COPY --from=builder /lib/x86_64-linux-gnu/libdl.so.2 /lib/libdl.so.2
COPY --from=builder /lib/x86_64-linux-gnu/libm.so.6 /lib/libm.so.6
COPY --from=builder /lib/x86_64-linux-gnu/libz.so.1 /lib/libz.so.1
COPY --from=builder /lib64/ld-linux-x86-64.so.2 /lib/ld-linux

COPY bundlebee-core /bin/bundlebee-core

CMD ["/lib/ld-linux", "/bin/bundlebee-core"]</code></pre>
</div>
</div>
</li>
<li>
<p>Run <code>docker build -t bundlebee .</code> in the folder you put <code>bundlebee</code> binary and previous <code>Dockerfile</code></p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
this dockerfile works as of today because binaries are build on Ubuntu 20.10, you can need to adjust a bit libraries if this changes - this is why Java mode is simpler.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_linting">Linting</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Linting is quite specific so it has its own <a href="linting.html">documentation</a>.</p>
</div>
</div>
</div>
                
                
            </div>
        </div>
    <div class="page-navigation-right">
        <h3>Navigation</h3>
        <nav class="generated-nav-menu"></nav>
    </div>
    </div>
    <footer class="footer pb-5">
	    <div class="text-center">
		    <ul class="social-list list-unstyled">
                <li class="list-inline-item"><a title="Github" href="https://www.github.com/yupiik/"><i class="fab fa-github fa-fw"></i></a></li><li class="list-inline-item"><a title="LinkedIn" href="https://www.linkedin.com/company/yupiik/"><i class="fab fa-linkedin fa-fw"></i></a></li>
	        </ul>
            <small class="copyright">Yupiik &copy;</small> | <a href="https://www.yupiik.com/terms-of-use/">Terms of use</a> | <a href="https://www.yupiik.com/privacy-policy/">Privacy policy</a>
	    </div>
    </footer>

    <div class="modal fade" id="searchModal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="searchModalLabel">Search</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form onsubmit="return false;" class="form-inline">
          <div class="form-group">
            <label for="searchInput"><b>Search: </b></label>
            <input class="form-control" id="searchInput" placeholder="Enter search text and hit enter...">
          </div>
        </form>
        <div class="search-hits"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" ></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.3/js/bootstrap.min.js" integrity="sha512-8qmis31OQi6hIRgvkht0s6mCOittjMa9GMqtK9hes5iEQBQE/Ca6yGE5FsW36vyipGoWQswBj/QBm2JR086Rkw==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.1/highlight.min.js" integrity="sha512-d00ajEME7cZhepRqSIVsQVGDJBdZlfHyQLNC6tZXYKTG7iwcF8nhlFuppanz8hYgXr8VvlfKh4gLC25ud3c90A==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.1/languages/bash.min.js" integrity="sha512-Hg0ufGEvn0AuzKMU0psJ1iH238iUN6THh7EI0CfA0n1sd3yu6PYet4SaDMpgzN9L1yQHxfB3yc5ezw3PwolIfA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.1/languages/bash.min.js" integrity="sha512-Hg0ufGEvn0AuzKMU0psJ1iH238iUN6THh7EI0CfA0n1sd3yu6PYet4SaDMpgzN9L1yQHxfB3yc5ezw3PwolIfA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.1/languages/json.min.js" integrity="sha512-37sW1XqaJmseHAGNg4N4Y01u6g2do6LZL8tsziiL5CMXGy04Th65OXROw2jeDeXLo5+4Fsx7pmhEJJw77htBFg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.1/languages/dockerfile.min.js" integrity="sha512-eRNl3ty7GOJPBN53nxLgtSSj2rkYj5/W0Vg0MFQBw8xAoILeT6byOogENHHCRRvHil4pKQ/HbgeJ5DOwQK3SJA==" crossorigin="anonymous"></script>
    <script>if (!(window.minisite || {}).skipHighlightJs) { hljs.highlightAll();
function addCopyButtons(clipboard) {
  document.querySelectorAll('pre > code').forEach(function (codeBlock) {
  var button = document.createElement('button');  button.className = 'copy-code-button';  button.type = 'button';  button.innerText = 'Copy';  button.addEventListener('click', function () {   clipboard.writeText(codeBlock.innerText).then(function () {   button.blur();   button.innerText = 'Copied!';   setTimeout(function () { button.innerText = 'Copy'; }, 2000); }, function (error) { button.innerText = 'Error'; });  });  var pre = codeBlock.parentNode;  if (pre.parentNode.classList.contains('highlight')) {   var highlight = pre.parentNode; highlight.parentNode.insertBefore(button, highlight);  } else { pre.parentNode.insertBefore(button, pre); } });}
if (navigator && navigator.clipboard) { addCopyButtons(navigator.clipboard);} else { var script = document.createElement('script'); script.src = '//cdnjs.cloudflare.com/ajax/libs/clipboard-polyfill/2.7.0/clipboard-polyfill.promise.js'; script.integrity = 'sha256-waClS2re9NUbXRsryKoof+F9qc1gjjIhc2eT7ZbIv94='; script.crossOrigin = 'anonymous'; script.onload = function() {addCopyButtons(clipboard);}; document.body.appendChild(script);} }</script>
    <script src="//www.yupiik.io/bundlebee/js/minisite.js?v=1.0.27-SNAPSHOT"></script>
    <script>$('.page-content-body').generatedNavMenu();</script>
    <script>
            document.querySelector('div.site-logo > a').href =
              document.location.pathname.indexOf('/bundlebee') == 0 ? '/bundlebee/index.html' : '/index.html';
            </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.3/fuse.min.js" integrity="sha512-neoBxVNv0UMXjoilAYGxfWrSsW6iAVclx7vQKdPJ9Peet1bM5YQjU0aIB8LtH8iNPa+pAyMZprBBw2ZQ/Q1LjQ==" crossorigin="anonymous"></script>

</body>
</html>
